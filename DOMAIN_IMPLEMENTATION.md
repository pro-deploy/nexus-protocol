# Добавление новых доменов в Nexus Protocol

## Архитектура доменов

Домен в Nexus Protocol представляет собой специализированный микросервис или модуль для обработки запросов определенной тематики (commerce, recipes, travel и т.д.).

### Компоненты домена

1. **Конфигурация домена** (Admin Service)
   - Метаданные домена (ID, имя, тип)
   - Настройки подключения (endpoint, auth)
   - Правила качества и ML модели
   - Ключевые слова для классификации

2. **Классификатор доменов** (AI Service)
   - Быстрая классификация по ключевым словам
   - Ollama классификация для сложных случаев
   - Семантические векторы для точности

3. **Обработка запросов** (AI Service)
   - Маршрутизация запросов к соответствующему домену
   - Анализ качества ответов
   - Кэширование результатов

## Процесс добавления нового домена

### Шаг 1: Определить спецификацию домена

```yaml
domain:
  id: "education"           # уникальный идентификатор
  name: "Образование"       # человеко-читаемое имя
  type: "education"         # тип домена
  keywords:                 # ключевые слова для классификации
    - "учить"
    - "курс"
    - "школа"
    - "университет"
  capabilities:             # возможности домена
    - type: "search"
      description: "Поиск образовательных материалов"
    - type: "learn"
      description: "Организация обучения"
```

### Шаг 2: Добавить домен в админ-конфигурацию

**Файл:** `server/go/internal/admin/service.go`

В методе `InitializeDefaultDomains()` добавить новый домен:

```go
{
    ID:         "education",
    Name:       "Образование и обучение",
    Type:       "education",
    Enabled:    true,
    Priority:   55,
    Timeout:    28,
    RetryCount: 2,
    Keywords:   []string{"учить", "курс", "школа", "университет", "обучение", "экзамен"},
    Capabilities: []DomainCapability{
        {Type: "search", Description: "Поиск образовательных материалов"},
        {Type: "learn", Description: "Организация обучения"},
    },
},
```

### Шаг 3: Обновить классификатор доменов

**Файл:** `server/go/internal/ai/service.go`

#### 3.1 Добавить ключевые слова в FastClassifier

В методе `initDomainData()` добавить в `domainKeywords`:

```go
"education": {
    "учить", "курс", "школа", "университет", "обучение", "экзамен",
    "студент", "учитель", "класс", "урок", "лекция", "семинар",
    "диплом", "аттестат", "образование", "знания", "навыки",
},
```

#### 3.2 Добавить семантический вектор

В `domainVectors` добавить вектор (6 значений от 0.0 до 1.0):

```go
"education": {0.1, 0.1, 0.1, 0.8, 0.2, 0.1},
```

#### 3.3 Обновить Ollama промпт

В методе `Classify()` у `OllamaClassifier` добавить домен в список:

```
- education (образование, обучение, курсы)
```

### Шаг 4: Реализовать бизнес-логику домена (опционально)

Если домен требует специальной обработки, создать отдельный сервис:

1. Создать новый пакет в `server/go/internal/`
2. Реализовать интерфейс `DomainHandler`
3. Зарегистрировать в `main.go`

### Шаг 5: Тестирование

1. Запустить сервер
2. Проверить классификацию запросов типа "хочу учить английский"
3. Проверить работу через API endpoints

## Примеры существующих доменов

### Commerce (Коммерция)
- **Ключевые слова:** купить, цена, магазин, товар
- **Возможности:** search, purchase
- **Приоритет:** 80 (высокий)

### Recipes (Рецепты)
- **Ключевые слова:** рецепт, готовить, еда, кухня
- **Возможности:** search, cook
- **Приоритет:** 60 (средний)

### Travel (Путешествия)
- **Ключевые слова:** отель, бронировать, путешествие
- **Возможности:** search, book
- **Приоритет:** 70 (выше среднего)

## Лучшие практики

1. **Ключевые слова:** Использовать наиболее частотные слова из целевой тематики
2. **Приоритет:** Высокий приоритет для коммерческих доменов, низкий для информационных
3. **Таймаут:** Учитывать сложность обработки (20-35 секунд)
4. **Векторы:** Настраивать семантические векторы для лучшей точности классификации
5. **Тестирование:** Всегда тестировать на реальных запросах пользователей

## Мониторинг и аналитика

После добавления домена отслеживать метрики:
- Точность классификации
- Время обработки
- Уровень удовлетворенности пользователей
- Конверсионные показатели

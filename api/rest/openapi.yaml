openapi: 3.0.3
info:
  title: Nexus Protocol - HTTP REST API
  description: |
    Nexus AI Platform - Nexus Protocol
    HTTP REST API Specification v2.0.0
  version: 2.0.0
  contact:
    name: Биркин Максим
    email: contact@nexus.dev
  license:
    name: MIT

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.nexus.dev/api/v1
    description: Production server

security:
  - bearerAuth: []
  - apiKey: []

paths:
  # Health Checks
  /health:
    get:
      summary: Health check
      description: Basic health check for load balancers
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: "2.0.0"

  /ready:
    get:
      summary: Readiness probe
      description: Detailed readiness check for Kubernetes
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ready"
                  timestamp:
                    type: string
                    format: date-time
                  checks:
                    type: object
                    properties:
                      database:
                        type: string
                        example: "ok"
                      redis:
                        type: string
                        example: "ok"
                      ai_services:
                        type: string
                        example: "ok"

  /version:
    get:
      summary: Get API version information
      description: Returns protocol version, server version, and build information
      tags:
        - System
      responses:
        '200':
          description: Version information
          content:
            application/json:
              schema:
                type: object
                properties:
                  protocol_version:
                    type: string
                    pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
                    example: "2.0.0"
                  server_version:
                    type: string
                    pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
                    example: "2.0.0"
                  api_version:
                    type: string
                    example: "v1"
                  build_info:
                    type: object
                    properties:
                      git_commit:
                        type: string
                        example: "abc123def456"
                      build_time:
                        type: string
                        format: date-time
                        example: "2025-01-18T10:00:00Z"

  # Context-Aware Templates
  /templates/execute:
    post:
      summary: Execute context-aware template
      description: Execute a template with AI-powered context analysis
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  description: User query in natural language
                  example: "хочу борщ"
                  minLength: 1
                  maxLength: 1000
                language:
                  type: string
                  description: Language code (ISO 639-1)
                  example: "ru"
                  enum: ["ru", "en"]
                  default: "ru"
                context:
                  $ref: '#/components/schemas/UserContext'
                options:
                  $ref: '#/components/schemas/ExecuteOptions'
                filters:
                  $ref: '#/components/schemas/AdvancedFilters'
                metadata:
                  $ref: '#/components/schemas/RequestMetadata'
      responses:
        '200':
          description: Template executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ExecuteTemplateResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          $ref: '#/components/responses/InternalError'

  /templates/status/{executionId}:
    get:
      summary: Get execution status
      description: Get the status of a template execution
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Execution ID
      responses:
        '200':
          description: Execution status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/TemplateExecution'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /templates/stream/{executionId}:
    get:
      summary: Stream template results
      description: Stream template execution results in real-time (Server-Sent Events)
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
                example: |
                  event: domain_result
                  data: {"domain_id": "commerce", "status": "completed", "results": [...]}

                  event: execution_complete
                  data: {"execution_id": "123", "status": "completed"}

  # Identity & Access Management
  /auth/register:
    post:
      summary: Register new user
      description: Create a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - first_name
                - last_name
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  minLength: 8
                  example: "password123"
                first_name:
                  type: string
                  example: "John"
                last_name:
                  type: string
                  example: "Doe"
                tenant_id:
                  type: string
                  format: uuid
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      user_id:
                        type: string
                        format: uuid
                      message:
                        type: string
                        example: "User registered successfully"
                      verification_required:
                        type: boolean
                        example: true
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: User login
      description: Authenticate user and return JWT tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                        example: "eyJhbGciOiJSUzI1NiIs..."
                      refresh_token:
                        type: string
                        example: "refresh_token_123"
                      token_type:
                        type: string
                        example: "Bearer"
                      expires_in:
                        type: integer
                        example: 3600
                      user:
                        $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/AuthenticationError'

  /auth/refresh:
    post:
      summary: Refresh access token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                      token_type:
                        type: string
                        example: "Bearer"
                      expires_in:
                        type: integer

  /users/profile:
    get:
      summary: Get user profile
      description: Get current user profile information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/UserProfile'
    put:
      summary: Update user profile
      description: Update current user profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                first_name:
                  type: string
                last_name:
                  type: string
                bio:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/UserProfile'

  # Conversational AI
  /conversations:
    post:
      summary: Create conversation
      description: Start a new AI conversation
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Recipe Discussion"
                bot_id:
                  type: string
                  format: uuid
                context:
                  type: object
                system_prompt:
                  type: string
      responses:
        '201':
          description: Conversation created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conversation'

  /conversations/{conversationId}:
    get:
      summary: Get conversation
      description: Get conversation details and messages
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Conversation retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conversation'

  /conversations/{conversationId}/messages:
    post:
      summary: Send message
      description: Send a message to the AI conversation
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                message_type:
                  type: string
                  enum: [text, voice, image]
                  default: text
                metadata:
                  type: object
      responses:
        '200':
          description: Message processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/MessageResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /conversations/{conversationId}/history:
    get:
      summary: Get conversation history
      description: Get message history for a conversation
      security:
        - bearerAuth: []
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Conversation ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Maximum number of messages to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of messages to skip
        - name: before
          in: query
          schema:
            type: string
            format: date-time
          description: Get messages before this timestamp
        - name: after
          in: query
          schema:
            type: string
            format: date-time
          description: Get messages after this timestamp
      responses:
        '200':
          description: Conversation history retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      messages:
                        type: array
                        items:
                          $ref: '#/components/schemas/Message'
                      total:
                        type: integer
                        format: int32
                      limit:
                        type: integer
                        format: int32
                      offset:
                        type: integer
                        format: int32
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /conversations/{conversationId}/typing:
    post:
      summary: Update typing status
      description: Update typing indicator for a conversation
      security:
        - bearerAuth: []
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Conversation ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - typing
              properties:
                typing:
                  type: boolean
                  description: Whether user is currently typing
      responses:
        '200':
          description: Typing status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      conversation_id:
                        type: string
                        format: uuid
                      typing:
                        type: boolean
                      timestamp:
                        type: string
                        format: date-time
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # Analytics
  /analytics/events:
    post:
      summary: Log analytics event
      description: Log an analytics event for tracking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - event_type
              properties:
                event_type:
                  type: string
                  example: "user_login"
                user_id:
                  type: string
                  format: uuid
                tenant_id:
                  type: string
                  format: uuid
                data:
                  type: object
      responses:
        '201':
          description: Event logged
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      event_id:
                        type: string
                        format: uuid
                      message:
                        type: string
                      timestamp:
                        type: string
                        format: date-time

    get:
      summary: Get analytics events
      description: Retrieve analytics events with filtering
      security:
        - bearerAuth: []
      parameters:
        - name: event_type
          in: query
          schema:
            type: string
        - name: user_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Events retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      events:
                        type: array
                        items:
                          $ref: '#/components/schemas/AnalyticsEvent'
                      total:
                        type: integer
                      limit:
                        type: integer
                      offset:
                        type: integer

  /analytics/stats:
    get:
      summary: Get analytics statistics
      description: Get comprehensive analytics statistics
      security:
        - bearerAuth: []
      parameters:
        - name: user_id
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by user ID
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by tenant ID
        - name: days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 365
            default: 7
          description: Number of days to analyze
        - name: start_date
          in: query
          schema:
            type: string
            format: date
            pattern: '^\d{4}-\d{2}-\d{2}$'
          description: Start date (YYYY-MM-DD format)
          example: "2025-01-01"
        - name: end_date
          in: query
          schema:
            type: string
            format: date
            pattern: '^\d{4}-\d{2}-\d{2}$'
          description: End date (YYYY-MM-DD format)
          example: "2025-01-31"
      responses:
        '200':
          description: Statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AnalyticsStats'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /analytics/user:
    get:
      summary: Get user-specific analytics
      description: Get analytics for the current user
      security:
        - bearerAuth: []
      parameters:
        - name: days
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 365
            default: 30
          description: Number of days to analyze
      responses:
        '200':
          description: User analytics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    description: User behavior analytics
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /analytics/realtime:
    get:
      summary: Get real-time metrics
      description: Get real-time analytics metrics
      security:
        - bearerAuth: []
      tags:
        - Analytics
      responses:
        '200':
          description: Real-time metrics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    description: Real-time metrics data
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /analytics/export:
    get:
      summary: Export analytics data
      description: Export analytics data in specified format
      security:
        - bearerAuth: []
      tags:
        - Analytics
      parameters:
        - name: format
          in: query
          schema:
            type: string
            enum: [json, csv, xlsx]
            default: json
          description: Export format
        - name: start_date
          in: query
          schema:
            type: string
            format: date
            pattern: '^\d{4}-\d{2}-\d{2}$'
          description: Start date (YYYY-MM-DD format)
          example: "2025-01-01"
        - name: end_date
          in: query
          schema:
            type: string
            format: date
            pattern: '^\d{4}-\d{2}-\d{2}$'
          description: End date (YYYY-MM-DD format)
          example: "2025-01-31"
      responses:
        '200':
          description: Analytics data exported
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      download_url:
                        type: string
                        format: uri
                        description: URL to download exported data
                      expires_at:
                        type: string
                        format: date-time
                        description: Expiration time of download URL
            application/csv:
              schema:
                type: string
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary

  /analytics/clean:
    post:
      summary: Clean old analytics data
      description: Delete analytics data older than specified days
      security:
        - bearerAuth: []
      tags:
        - Analytics
      parameters:
        - name: days_to_keep
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 3650
            default: 90
          description: Number of days to keep (data older will be deleted)
      responses:
        '200':
          description: Analytics data cleaned
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      deleted_count:
                        type: integer
                        format: int64
                        description: Number of records deleted
                      message:
                        type: string
                        description: Cleanup status message
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  # Enterprise Batch Operations v2.0.0
  /batch/execute:
    post:
      summary: Execute batch operations
      description: Execute multiple template operations in a single request
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - requests
              properties:
                requests:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExecuteTemplateRequest'
                  minItems: 1
                  maxItems: 100
                batch_options:
                  $ref: '#/components/schemas/ExecuteOptions'
                metadata:
                  $ref: '#/components/schemas/RequestMetadata'
      responses:
        '200':
          description: Batch executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/BatchResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /batch/{batchId}/status:
    get:
      summary: Get batch execution status
      description: Get the status of a batch execution
      security:
        - bearerAuth: []
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Batch execution ID
      responses:
        '200':
          description: Batch status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/BatchResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /batch/stats:
    get:
      summary: Get batch statistics
      description: Get statistics about batch operations
      security:
        - bearerAuth: []
      tags:
        - Batch
      responses:
        '200':
          description: Batch statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      total_batches:
                        type: integer
                        format: int64
                        description: Total number of batch operations
                      active_batches:
                        type: integer
                        format: int32
                        description: Number of active batch operations
                      completed_batches:
                        type: integer
                        format: int64
                        description: Number of completed batch operations
                      failed_batches:
                        type: integer
                        format: int64
                        description: Number of failed batch operations
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /batch/{batchId}/cancel:
    post:
      summary: Cancel batch execution
      description: Cancel a running batch operation
      security:
        - bearerAuth: []
      tags:
        - Batch
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Batch execution ID
      responses:
        '200':
          description: Batch cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      batch_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: [cancelled]
                      message:
                        type: string
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '409':
          description: Batch cannot be cancelled (already completed or failed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /batch/{batchId}/operations:
    get:
      summary: Get batch operations
      description: Get list of operations in a batch
      security:
        - bearerAuth: []
      tags:
        - Batch
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Batch execution ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Maximum number of operations to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of operations to skip
      responses:
        '200':
          description: Batch operations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      operations:
                        type: array
                        items:
                          type: object
                          properties:
                            operation_id:
                              type: integer
                              format: int32
                            status:
                              type: string
                              enum: [pending, in_progress, completed, failed]
                            request:
                              $ref: '#/components/schemas/ExecuteTemplateRequest'
                            response:
                              $ref: '#/components/schemas/ExecuteTemplateResponse'
                      total:
                        type: integer
                        format: int32
                      limit:
                        type: integer
                        format: int32
                      offset:
                        type: integer
                        format: int32
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # Enterprise Webhook Management v2.0.0
  /webhooks:
    post:
      summary: Register webhook
      description: Register a new webhook for event notifications
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
                - events
              properties:
                url:
                  type: string
                  format: uri
                  example: "https://api.company.com/webhooks/nexus"
                events:
                  type: array
                  items:
                    type: string
                    enum: [template_executed, batch_completed, error_occurred]
                  example: ["template_executed", "batch_completed"]
                headers:
                  type: object
                  additionalProperties:
                    type: string
                secret:
                  type: string
                  minLength: 16
                  description: Secret for webhook signature verification
      responses:
        '201':
          description: Webhook registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/WebhookConfig'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
    get:
      summary: List webhooks
      description: Get list of registered webhooks
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Webhooks retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookConfig'

  /webhooks/{webhookId}:
    delete:
      summary: Unregister webhook
      description: Remove a webhook registration
      security:
        - bearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Webhook ID
      responses:
        '204':
          description: Webhook unregistered

  # Frontend Configuration (Public)
  /frontend/config:
    get:
      summary: Get active frontend configuration
      description: |
        Returns the active frontend configuration including theme, colors, layout, and branding.
        This is a public endpoint that does not require authentication.
      tags:
        - Frontend
      responses:
        '200':
          description: Frontend configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /webhooks/{webhookId}/deliveries:
    get:
      summary: Get webhook deliveries
      description: Get delivery history for a webhook
      security:
        - bearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Webhook ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
          description: Maximum number of deliveries to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of deliveries to skip
      responses:
        '200':
          description: Deliveries retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookDelivery'
                  total:
                    type: integer
                    format: int32
                  limit:
                    type: integer
                    format: int32
                  offset:
                    type: integer
                    format: int32
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /webhooks/{webhookId}/test:
    post:
      summary: Test webhook
      description: Send a test event to the webhook
      security:
        - bearerAuth: []
      tags:
        - Webhooks
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Webhook ID
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                event_type:
                  type: string
                  enum: [template_executed, batch_completed, error_occurred]
                  default: template_executed
                  description: Type of test event to send
                test_data:
                  type: object
                  additionalProperties: true
                  description: Optional test data to include in the webhook payload
      responses:
        '200':
          description: Webhook test completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      webhook_id:
                        type: string
                        format: uuid
                      status:
                        type: string
                        enum: [success, failed]
                      response_code:
                        type: integer
                        format: int32
                        description: HTTP status code from webhook endpoint
                      response_time_ms:
                        type: integer
                        format: int32
                        description: Response time in milliseconds
                      error:
                        type: string
                        description: Error message if test failed
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /webhooks/stats:
    get:
      summary: Get webhook statistics
      description: Get statistics about webhooks
      security:
        - bearerAuth: []
      tags:
        - Webhooks
      responses:
        '200':
          description: Webhook statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      total_webhooks:
                        type: integer
                        format: int32
                        description: Total number of registered webhooks
                      active_webhooks:
                        type: integer
                        format: int32
                        description: Number of active webhooks
                      total_deliveries:
                        type: integer
                        format: int64
                        description: Total number of webhook deliveries
                      successful_deliveries:
                        type: integer
                        format: int64
                        description: Number of successful deliveries
                      failed_deliveries:
                        type: integer
                        format: int64
                        description: Number of failed deliveries
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  # Admin Panel Endpoints (Superuser only)
  /admin/ai/config:
    get:
      summary: Get AI configuration
      description: Retrieve current AI provider and model configuration
      tags:
        - Admin
        - AI
      security:
        - bearerAuth: []
      responses:
        '200':
          description: AI configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AIConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update AI configuration
      description: Update AI provider and model configuration
      tags:
        - Admin
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AIConfig'
      responses:
        '200':
          description: AI configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "AI configuration updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/prompts:
    get:
      summary: List prompts
      description: Get list of prompts, optionally filtered by domain
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: domain
          in: query
          schema:
            type: string
            enum: [commerce, recipes, travel, knowledge, health, finance]
          description: Filter by domain
        - name: active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Prompts retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PromptConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create prompt
      description: Create a new prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromptConfig'
      responses:
        '201':
          description: Prompt created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/prompts/{id}:
    get:
      summary: Get prompt
      description: Get a specific prompt by ID
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      responses:
        '200':
          description: Prompt retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update prompt
      description: Update a prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromptConfig'
      responses:
        '200':
          description: Prompt updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete prompt
      description: Delete a prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      responses:
        '204':
          description: Prompt deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains:
    get:
      summary: List domains
      description: Get list of all domain configurations
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Domains retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DomainConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create domain
      description: Create a new domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainConfig'
      responses:
        '201':
          description: Domain created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}:
    get:
      summary: Get domain
      description: Get a specific domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Domain retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain
      description: Update a domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainConfig'
      responses:
        '200':
          description: Domain updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete domain
      description: Delete a domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '204':
          description: Domain deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/keywords:
    get:
      summary: Get domain keywords
      description: Get keywords for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Keywords retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain keywords
      description: Update keywords for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
      responses:
        '200':
          description: Keywords updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain keywords updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/capabilities:
    get:
      summary: Get domain capabilities
      description: Get capabilities for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Capabilities retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DomainCapability'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain capabilities
      description: Update capabilities for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DomainCapability'
      responses:
        '200':
          description: Capabilities updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain capabilities updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/quality-rules:
    get:
      summary: Get domain quality rules
      description: Get quality rules for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Quality rules retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QualityRule'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain quality rules
      description: Update quality rules for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/QualityRule'
      responses:
        '200':
          description: Quality rules updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain quality rules updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/ml-model:
    get:
      summary: Get domain ML model
      description: Get ML model configuration for a specific domain
      tags:
        - Admin
        - Domains
        - ML
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: ML model retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainMLModel'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain ML model
      description: Update ML model configuration for a domain
      tags:
        - Admin
        - Domains
        - ML
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainMLModel'
      responses:
        '200':
          description: ML model updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain ML model updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/initialize-default:
    post:
      summary: Initialize default domains
      description: Create default domain configurations
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Default domains initialized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Default domains initialized successfully"
                  domains_created:
                    type: integer
                    example: 6
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/integrations:
    get:
      summary: List integrations
      description: Get list of integrations, optionally filtered by type
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [payment, delivery, notifications, analytics, custom]
          description: Filter by integration type
      responses:
        '200':
          description: Integrations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/IntegrationConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create integration
      description: Create a new integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationConfig'
      responses:
        '201':
          description: Integration created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/integrations/{id}:
    get:
      summary: Get integration
      description: Get a specific integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      responses:
        '200':
          description: Integration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update integration
      description: Update an integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationConfig'
      responses:
        '200':
          description: Integration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete integration
      description: Delete an integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      responses:
        '204':
          description: Integration deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs:
    get:
      summary: List frontend configurations
      description: Get list of all frontend configurations
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Frontend configurations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create frontend configuration
      description: Create a new frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrontendConfig'
      responses:
        '201':
          description: Frontend configuration created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs/{id}:
    get:
      summary: Get frontend configuration
      description: Get a specific frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '200':
          description: Frontend configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update frontend configuration
      description: Update a frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrontendConfig'
      responses:
        '200':
          description: Frontend configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete frontend configuration
      description: Delete a frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '204':
          description: Frontend configuration deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/active:
    get:
      summary: Get active frontend configuration
      description: Get the currently active frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Active frontend configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs/{id}/active:
    put:
      summary: Set active frontend configuration
      description: Set a frontend configuration as active
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '200':
          description: Frontend configuration set as active
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Frontend configuration set as active"
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    # Common schemas
    RequestMetadata:
      type: object
      required:
        - request_id
        - protocol_version
        - client_version
        - timestamp
      properties:
        request_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        protocol_version:
          type: string
          pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
          example: "2.0.0"
        client_version:
          type: string
          pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
          example: "2.0.0"
        client_id:
          type: string
          maxLength: 100
          example: "web-app"
        client_type:
          type: string
          enum: [web, mobile, sdk, api, desktop]
          example: "web"
        timestamp:
          type: integer
          format: int64
          minimum: 0
          example: 1640995200
        custom_headers:
          type: object
          additionalProperties:
            type: string

    ResponseMetadata:
      type: object
      required:
        - request_id
        - protocol_version
        - server_version
        - timestamp
        - processing_time_ms
      properties:
        request_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        protocol_version:
          type: string
          pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
          example: "2.0.0"
        server_version:
          type: string
          pattern: '^\d+\.\d+\.\d+(-[a-zA-Z0-9.-]+)?(\+[a-zA-Z0-9.-]+)?$'
          example: "2.0.0"
        timestamp:
          type: integer
          format: int64
          minimum: 0
          example: 1640995235
        processing_time_ms:
          type: integer
          format: int32
          minimum: 0
          example: 150
        # Enterprise features v2.0.0
        rate_limit_info:
          $ref: '#/components/schemas/RateLimitInfo'
        cache_info:
          $ref: '#/components/schemas/CacheInfo'
        quota_info:
          $ref: '#/components/schemas/QuotaInfo'

    ErrorResponse:
      type: object
      required:
        - error
      properties:
        error:
          type: object
          description: ErrorDetail согласно Nexus Protocol v2.0.0
          required:
            - code
            - type
            - message
          properties:
            code:
              type: string
              description: Машинно-читаемый код ошибки (UPPER_SNAKE_CASE)
              pattern: '^[A-Z_]+$'
              example: "VALIDATION_FAILED"
            type:
              type: string
              description: Категория ошибки
              enum: [VALIDATION_ERROR, AUTHENTICATION_ERROR, AUTHORIZATION_ERROR, NOT_FOUND, CONFLICT, RATE_LIMIT_ERROR, INTERNAL_ERROR, EXTERNAL_ERROR, PROTOCOL_VERSION_ERROR]
              example: "VALIDATION_ERROR"
            message:
              type: string
              maxLength: 1000
              example: "Query cannot be empty"
            field:
              type: string
              maxLength: 100
              example: "query"
            details:
              type: string
              maxLength: 5000
            metadata:
              type: object
              additionalProperties:
                type: string

    # Domain-specific schemas
    UserContext:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        session_id:
          type: string
        tenant_id:
          type: string
          format: uuid
        roles:
          type: array
          items:
            type: string
          description: Роли пользователя
        location:
          $ref: '#/components/schemas/UserLocation'
        locale:
          type: string
          description: Локаль пользователя (ru-RU, en-US)
          example: "ru-RU"
        timezone:
          type: string
          description: Часовой пояс (Europe/Moscow)
          example: "Europe/Moscow"
        currency:
          type: string
          description: Валюта (RUB, USD, EUR)
          example: "RUB"
        region:
          type: string
          description: Регион (RU, US, EU)
          example: "RU"

    UserLocation:
      type: object
      properties:
        latitude:
          type: number
          format: float
          minimum: -90
          maximum: 90
        longitude:
          type: number
          format: float
          minimum: -180
          maximum: 180
        accuracy:
          type: number
          format: float
          minimum: 0

    ExecuteOptions:
      type: object
      properties:
        timeout_ms:
          type: integer
          minimum: 0
          maximum: 120000
          default: 30000
        max_results_per_domain:
          type: integer
          minimum: 0
          maximum: 50
          default: 5
        parallel_execution:
          type: boolean
          default: true
        include_web_search:
          type: boolean
          default: true

    AdvancedFilters:
      type: object
      description: Расширенные фильтры результатов
      properties:
        domains:
          type: array
          items:
            type: string
          description: Список доменов для включения
        exclude_domains:
          type: array
          items:
            type: string
          description: Список доменов для исключения
        min_relevance:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Минимальная релевантность (0-1)
        max_results:
          type: integer
          minimum: 0
          maximum: 100
          description: Максимальное количество результатов
        sort_by:
          type: string
          enum: [relevance, date, rating]
          description: Сортировка результатов
        date_range:
          $ref: '#/components/schemas/DateRange'

    DateRange:
      type: object
      description: Диапазон дат
      properties:
        from:
          type: integer
          format: int64
          minimum: 0
          description: Timestamp начала (Unix timestamp в секундах)
        to:
          type: integer
          format: int64
          minimum: 0
          description: Timestamp конца (Unix timestamp в секундах)

    ExecuteTemplateResponse:
      type: object
      required:
        - execution_id
        - status
      properties:
        execution_id:
          type: string
          format: uuid
        intent_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [in_progress, completed, partial, failed, timeout]
        query_type:
          type: string
          enum: [information_only, with_purchases_services, mixed]
        sections:
          type: array
          items:
            $ref: '#/components/schemas/DomainSection'
        web_search:
          $ref: '#/components/schemas/WebSearchResult'
        ranking:
          $ref: '#/components/schemas/RankingResult'
        metadata:
          $ref: '#/components/schemas/ExecutionMetadata'
        processing_time_ms:
          type: integer
          format: int32
          minimum: 0
        domain_analysis:
          $ref: '#/components/schemas/DomainAnalysisResult'
        response_metadata:
          $ref: '#/components/schemas/ResponseMetadata'
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    DomainSection:
      type: object
      required:
        - domain_id
        - status
      properties:
        domain_id:
          type: string
          example: "commerce"
          description: Идентификатор домена
        title:
          type: string
          example: "Product Recommendations"
          description: Заголовок секции домена
        status:
          type: string
          enum: [success, error, timeout, partial]
          description: Статус выполнения домена
        error:
          type: string
          description: Сообщение об ошибке (если status = error)
        response_time_ms:
          type: integer
          format: int32
          minimum: 0
          description: Время ответа домена в миллисекундах
        results:
          type: array
          items:
            $ref: '#/components/schemas/ResultItem'
          description: Результаты из домена

    ResultItem:
      type: object
      required:
        - id
        - type
        - title
      properties:
        id:
          type: string
          description: Уникальный идентификатор результата
        type:
          type: string
          example: "product"
          description: Тип результата
        title:
          type: string
          description: Заголовок результата
        description:
          type: string
          description: Описание результата
        data:
          type: object
          additionalProperties: true
          description: Структурированные данные результата (может содержать сложные объекты: stores, addresses и т.д.)
        relevance:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Релевантность результата (0.0-1.0)
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Уверенность в результате (0.0-1.0)
        actions:
          type: array
          items:
            $ref: '#/components/schemas/Action'
          description: Доступные действия для результата

    Action:
      type: object
      required:
        - type
        - label
      properties:
        type:
          type: string
          example: "add_to_cart"
          description: Тип действия
        label:
          type: string
          example: "Добавить в корзину"
          description: Текст кнопки/ссылки действия
        url:
          type: string
          format: uri
          description: URL для выполнения действия
        method:
          type: string
          enum: [GET, POST, PUT, DELETE]
          default: POST
          description: HTTP метод для выполнения действия
        confirm_text:
          type: string
          description: Текст подтверждения действия (для диалога)

    WebSearchResult:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        search_engine:
          type: string
          example: "google"
        total_results:
          type: integer

    SearchResult:
      type: object
      properties:
        title:
          type: string
        url:
          type: string
        snippet:
          type: string
        relevance:
          type: number
          format: float

    RankingResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/RankedItem'
          description: Ранжированные элементы
        algorithm:
          type: string
          example: "weighted_relevance_confidence"
          description: Алгоритм ранжирования, использованный для сортировки результатов

    RankedItem:
      type: object
      required:
        - id
        - score
        - rank
      properties:
        id:
          type: string
          description: Идентификатор ранжированного элемента
        score:
          type: number
          format: float
          minimum: 0
          description: Оценка ранжирования
        rank:
          type: integer
          format: int32
          minimum: 1
          description: Позиция в рейтинге (1-based)

    ExecutionMetadata:
      type: object
      required:
        - started_at
      properties:
        started_at:
          type: integer
          format: int64
          minimum: 0
          description: Время начала выполнения (Unix timestamp в секундах)
        completed_at:
          type: integer
          format: int64
          minimum: 0
          description: Время завершения выполнения (Unix timestamp в секундах)
        total_time_ms:
          type: integer
          format: int64
          minimum: 0
          description: Общее время выполнения в миллисекундах
        domain_stats:
          type: object
          additionalProperties:
            type: integer
          description: Статистика по каждому домену (domain_id -> количество результатов)
        domains_executed:
          type: integer
          format: int32
          minimum: 0
          description: Количество выполненных доменов
        results_count:
          type: integer
          format: int32
          minimum: 0
          description: Общее количество результатов

    TemplateExecution:
      type: object
      properties:
        id:
          type: string
          format: uuid
        intent_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [in_progress, completed, partial, failed, timeout]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        error_message:
          type: string

    # AI Domain Analysis Schemas
    DomainAnalysisResult:
      type: object
      description: Результат анализа выбора доменов
      required:
        - confidence
      properties:
        selected_domains:
          type: array
          items:
            $ref: '#/components/schemas/DomainSelection'
          description: Выбранные домены для обработки запроса
        rejected_domains:
          type: array
          items:
            $ref: '#/components/schemas/DomainSelection'
          description: Отклоненные домены (не подходят для запроса)
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Общая уверенность анализа (0.0-1.0)
        analysis_algorithm:
          type: string
          example: "hybrid_keyword_semantic"
          description: Алгоритм анализа, использованный для выбора доменов

    DomainSelection:
      type: object
      description: Выбор домена с анализом
      required:
        - domain_id
        - name
        - type
        - confidence
        - relevance
        - priority
      properties:
        domain_id:
          type: string
          example: "commerce"
          description: Идентификатор домена
        name:
          type: string
          example: "Коммерция и покупки"
          description: Название домена
        type:
          type: string
          example: "commerce"
          description: Тип домена
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Уверенность в выборе домена (0.0-1.0)
        relevance:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Релевантность домена для запроса (0.0-1.0)
        reason:
          type: string
          description: Причина выбора/отклонения домена
        priority:
          type: integer
          format: int32
          minimum: 0
          maximum: 100
          description: Приоритет домена (0-100)
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Дополнительные метаданные домена
        capabilities:
          type: array
          items:
            $ref: '#/components/schemas/DomainCapability'
          description: Возможности домена

    DomainCapability:
      type: object
      description: Возможности домена
      required:
        - type
      properties:
        type:
          type: string
          example: "search"
          description: Тип возможности (search, purchase, booking, etc.)
        description:
          type: string
          example: "Поиск в домене"
          description: Описание возможности
        parameters:
          type: object
          additionalProperties:
            type: string
          description: Параметры возможности

    PaginationInfo:
      type: object
      description: Информация о пагинации результатов
      properties:
        page:
          type: integer
          format: int32
          minimum: 1
          description: Текущая страница (1-based)
        page_size:
          type: integer
          format: int32
          minimum: 1
          maximum: 100
          description: Размер страницы
        total_pages:
          type: integer
          format: int32
          minimum: 0
          description: Общее количество страниц
        total_items:
          type: integer
          format: int64
          minimum: 0
          description: Общее количество элементов
        has_next:
          type: boolean
          description: Есть ли следующая страница
        has_previous:
          type: boolean
          description: Есть ли предыдущая страница
        next_cursor:
          type: string
          description: Курсор для следующей страницы (для cursor-based pagination)
        prev_cursor:
          type: string
          description: Курсор для предыдущей страницы (для cursor-based pagination)

    ResponseQualityAnalysis:
      type: object
      description: Анализ качества ответа домена
      required:
        - domain_id
        - overall_quality
      properties:
        domain_id:
          type: string
          example: "commerce"
          description: Идентификатор домена
        overall_quality:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Общее качество ответа (0.0-1.0)
        relevance_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Оценка релевантности (0.0-1.0)
        completeness_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Оценка полноты (0.0-1.0)
        accuracy_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Оценка точности (0.0-1.0)
        helpfulness_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Оценка полезности (0.0-1.0)
        issues:
          type: array
          items:
            $ref: '#/components/schemas/QualityIssue'
          description: Список проблем качества
        suggestions:
          type: array
          items:
            type: string
          description: Предложения по улучшению
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Дополнительные метаданные анализа

    QualityIssue:
      type: object
      description: Проблема с качеством ответа
      required:
        - type
        - severity
        - description
      properties:
        type:
          type: string
          enum: [relevance, completeness, accuracy, helpfulness]
          description: Тип проблемы качества
        severity:
          type: string
          enum: [low, medium, high, critical]
          description: Серьезность проблемы
        description:
          type: string
          description: Описание проблемы
        suggestion:
          type: string
          description: Предложение по улучшению

    DomainRoutingDecision:
      type: object
      description: Решение о маршрутизации запроса
      required:
        - domain_id
        - action
        - priority
      properties:
        domain_id:
          type: string
          description: Идентификатор домена
        action:
          type: string
          enum: [execute, reroute, skip, fallback]
          description: Действие для домена
        priority:
          type: integer
          format: int32
          minimum: 0
          maximum: 100
          description: Приоритет домена (0-100)
        reason:
          type: string
          description: Причина решения
        alternatives:
          type: array
          items:
            type: string
          description: Альтернативные домены
        metadata:
          type: object
          additionalProperties: true
          description: Дополнительные метаданные решения

    UserProfile:
      type: object
      required:
        - id
        - email
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор пользователя
        email:
          type: string
          format: email
          description: Email адрес пользователя
        username:
          type: string
          description: Имя пользователя
        first_name:
          type: string
          description: Имя
        last_name:
          type: string
          description: Фамилия
        status:
          type: string
          enum: [active, inactive, suspended]
          description: Статус пользователя
        roles:
          type: array
          items:
            type: string
          description: Роли пользователя
        created_at:
          type: integer
          format: int64
          minimum: 0
          description: Время создания аккаунта (Unix timestamp в секундах)
        last_login_at:
          type: integer
          format: int64
          minimum: 0
          description: Время последнего входа (Unix timestamp в секундах)

    Conversation:
      type: object
      required:
        - id
        - user_id
        - status
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор разговора
        user_id:
          type: string
          format: uuid
          description: Идентификатор пользователя
        bot_id:
          type: string
          format: uuid
          description: Идентификатор бота/AI ассистента
        title:
          type: string
          description: Заголовок разговора
        status:
          type: string
          enum: [active, archived, deleted]
          description: Статус разговора
        message_count:
          type: integer
          format: int32
          minimum: 0
          description: Количество сообщений в разговоре
        created_at:
          type: string
          format: date-time
          description: Время создания разговора
        last_activity:
          type: string
          format: date-time
          description: Время последней активности
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
          description: Список сообщений в разговоре

    Message:
      type: object
      required:
        - id
        - conversation_id
        - sender_type
        - type
        - content
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор сообщения
        conversation_id:
          type: string
          format: uuid
          description: Идентификатор разговора
        sender_id:
          type: string
          format: uuid
          description: Идентификатор отправителя
        sender_type:
          type: string
          enum: [user, assistant, system]
          description: Тип отправителя
        type:
          type: string
          enum: [text, voice, image]
          description: Тип содержимого сообщения
        content:
          type: string
          description: Содержимое сообщения
        status:
          type: string
          enum: [sent, delivered, read, failed]
          description: Статус доставки сообщения
        created_at:
          type: string
          format: date-time
          description: Время создания сообщения
        intent:
          type: string
          description: Определенный интент сообщения

    MessageResponse:
      type: object
      required:
        - conversation_id
        - user_message
        - ai_response
      properties:
        conversation_id:
          type: string
          format: uuid
          description: Идентификатор разговора
        user_message:
          $ref: '#/components/schemas/Message'
          description: Сообщение пользователя
        ai_response:
          $ref: '#/components/schemas/Message'
          description: Ответ AI ассистента
        conversation_status:
          type: string
          description: Статус разговора после обработки сообщения
        total_messages:
          type: integer
          format: int32
          minimum: 0
          description: Общее количество сообщений в разговоре

    AnalyticsEvent:
      type: object
      required:
        - id
        - event_type
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Уникальный идентификатор события
        event_type:
          type: string
          description: Тип события (например, template_executed, user_login, etc.)
        user_id:
          type: string
          format: uuid
          description: Идентификатор пользователя
        tenant_id:
          type: string
          format: uuid
          description: Идентификатор тенанта
        data:
          type: object
          additionalProperties: true
          description: Дополнительные данные события
        timestamp:
          type: string
          format: date-time
          description: Время события

    AnalyticsStats:
      type: object
      required:
        - period_days
        - total_events
      properties:
        period_days:
          type: integer
          format: int32
          minimum: 1
          description: Период анализа в днях
        total_events:
          type: integer
          format: int64
          minimum: 0
          description: Общее количество событий за период
        total_users:
          type: integer
          format: int32
          minimum: 0
          description: Общее количество уникальных пользователей
        active_users:
          type: integer
          format: int32
          minimum: 0
          description: Количество активных пользователей
        events_today:
          type: integer
          format: int32
          minimum: 0
          description: Количество событий сегодня
        top_events:
          type: array
          items:
            type: object
            properties:
              event:
                type: string
              count:
                type: integer
              percentage:
                type: number
                format: float
        user_activity:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              active_users:
                type: integer
              total_events:
                type: integer

    # Enterprise Features v2.0.0
    RateLimitInfo:
      type: object
      properties:
        limit:
          type: integer
          format: int32
          minimum: 0
          example: 1000
        remaining:
          type: integer
          format: int32
          minimum: 0
          example: 950
        reset_at:
          type: integer
          format: int64
          minimum: 0
          example: 1640996100

    CacheInfo:
      type: object
      properties:
        cache_hit:
          type: boolean
          description: Whether result was served from cache
          example: true
        cache_key:
          type: string
          description: Cache key used
          example: "template:query:hash"
        cache_ttl:
          type: integer
          format: int32
          minimum: 0
          description: Cache TTL in seconds
          example: 300

    QuotaInfo:
      type: object
      properties:
        quota_used:
          type: integer
          format: int64
          minimum: 0
          description: Quota used
          example: 50000
        quota_limit:
          type: integer
          format: int64
          minimum: 0
          description: Quota limit
          example: 100000
        quota_type:
          type: string
          enum: [requests, data, storage, bandwidth]
          description: Type of quota
          example: "requests"

    BatchResponse:
      type: object
      required:
        - batch_id
        - responses
        - batch_metadata
      properties:
        batch_id:
          type: string
          format: uuid
          description: Уникальный идентификатор batch операции
        responses:
          type: array
          items:
            $ref: '#/components/schemas/ExecuteTemplateResponse'
          description: Ответы на запросы в batch
        batch_metadata:
          $ref: '#/components/schemas/BatchMetadata'
          description: Метаданные выполнения batch операции

    BatchMetadata:
      type: object
      required:
        - total_requests
        - successful_requests
        - failed_requests
        - started_at
      properties:
        total_requests:
          type: integer
          format: int32
          minimum: 0
          description: Общее количество запросов в batch
        successful_requests:
          type: integer
          format: int32
          minimum: 0
          description: Количество успешных запросов
        failed_requests:
          type: integer
          format: int32
          minimum: 0
          description: Количество неудачных запросов
        started_at:
          type: integer
          format: int64
          minimum: 0
          description: Время начала batch операции (Unix timestamp в секундах)
        completed_at:
          type: integer
          format: int64
          minimum: 0
          description: Время завершения batch операции (Unix timestamp в секундах)
        total_processing_time_ms:
          type: integer
          format: int32
          minimum: 0
          description: Общее время обработки batch операции в миллисекундах

    WebhookConfig:
      type: object
      required:
        - url
        - events
      properties:
        webhook_id:
          type: string
          format: uuid
          description: Уникальный ID webhook (генерируется сервером)
        url:
          type: string
          format: uri
          description: URL для отправки webhook
        events:
          type: array
          items:
            type: string
            enum: [template_executed, batch_completed, error_occurred]
          minItems: 1
          description: Список событий для подписки
        headers:
          type: object
          additionalProperties:
            type: string
          description: Дополнительные заголовки для webhook запросов
        secret:
          type: string
          minLength: 16
          description: Secret для подписи webhook (минимум 16 символов)
        created_at:
          type: string
          format: date-time
          description: Время создания webhook

    WebhookDelivery:
      type: object
      required:
        - delivery_id
        - webhook_id
        - event_type
        - delivered_at
        - status_code
      properties:
        delivery_id:
          type: string
          format: uuid
          description: Уникальный идентификатор доставки
        webhook_id:
          type: string
          format: uuid
          description: Идентификатор webhook
        event_type:
          type: string
          description: Тип события
        payload:
          type: string
          description: JSON payload события
        signature:
          type: string
          description: HMAC подпись для верификации
        delivered_at:
          type: string
          format: date-time
          description: Время доставки
        status_code:
          type: integer
          format: int32
          minimum: 100
          maximum: 599
          description: HTTP статус код ответа от получателя
        response_body:
          type: string
          description: Тело ответа от получателя

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    AuthenticationError:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    AuthorizationError:
      description: Authorization failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    RateLimitError:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    FrontendConfig:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Corporate Theme"
        theme:
          type: string
          enum: [light, dark, custom]
          example: "light"
        colors:
          type: object
          additionalProperties:
            type: string
          example:
            primary: "#0066CC"
            secondary: "#00CC66"
            accent: "#FF6600"
            background: "#FFFFFF"
            text: "#333333"
        layout:
          type: object
          additionalProperties: true
          example:
            header:
              height: "64px"
              sticky: true
            sidebar:
              width: "240px"
              collapsible: true
        components:
          type: object
          additionalProperties: true
          example:
            button:
              border_radius: "8px"
              padding: "12px 24px"
            card:
              shadow: "0 2px 8px rgba(0,0,0,0.1)"
              border_radius: "12px"
        branding:
          type: object
          additionalProperties:
            type: string
          example:
            logo: "https://cdn.example.com/logo.png"
            name: "Nexus Protocol"
            favicon: "https://cdn.example.com/favicon.ico"
        active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Admin Schemas
    AIConfig:
      type: object
      properties:
        provider:
          type: string
          enum: [openai, anthropic, local, custom]
          example: "openai"
        model:
          type: string
          example: "gpt-4-turbo"
        api_key:
          type: string
          description: "Encrypted API key"
        base_url:
          type: string
          example: "https://api.openai.com/v1"
        max_tokens:
          type: integer
          example: 4000
        temperature:
          type: number
          format: float
          example: 0.7
        top_p:
          type: number
          format: float
          example: 1.0
        timeout:
          type: integer
          example: 60
        custom_params:
          type: object
          additionalProperties:
            type: string
          example:
            presence_penalty: "0.0"
            frequency_penalty: "0.0"
        enabled:
          type: boolean
          example: true

    PromptConfig:
      type: object
      properties:
        id:
          type: string
          example: "prompt-commerce-001"
        name:
          type: string
          example: "Commerce Product Search"
        description:
          type: string
          example: "Prompt for product search"
        domain:
          type: string
          enum: [commerce, recipes, travel, knowledge, health, finance]
          example: "commerce"
        type:
          type: string
          enum: [system, user, assistant]
          example: "system"
        template:
          type: string
          example: "You are a helpful assistant for product search. Query: {{query}}"
        variables:
          type: array
          items:
            type: string
          example: ["query", "location"]
        version:
          type: integer
          example: 1
        active:
          type: boolean
          example: true
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            author: "admin"
            tags: "commerce,search"

    DomainConfig:
      type: object
      properties:
        id:
          type: string
          example: "domain-commerce-001"
        name:
          type: string
          example: "Commerce Service"
        type:
          type: string
          enum: [commerce, recipes, travel, knowledge, health, finance, custom]
          example: "commerce"
        enabled:
          type: boolean
          example: true
        endpoint:
          type: string
          example: "https://commerce-api.example.com/v1"
        auth_type:
          type: string
          enum: [none, api_key, oauth2, jwt]
          example: "api_key"
        auth_config:
          type: object
          additionalProperties:
            type: string
          example:
            api_key: "encrypted_key"
            header_name: "X-API-Key"
        timeout:
          type: integer
          example: 30
        retry_count:
          type: integer
          example: 3
        priority:
          type: integer
          minimum: 0
          maximum: 100
          example: 80
        keywords:
          type: array
          items:
            type: string
          example: ["купить", "цена", "магазин", "товар"]
        capabilities:
          type: array
          items:
            $ref: '#/components/schemas/DomainCapability'
        quality_rules:
          type: array
          items:
            $ref: '#/components/schemas/QualityRule'
        ml_model:
          $ref: '#/components/schemas/DomainMLModel'
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            version: "2.0.0"
            region: "us-east-1"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DomainCapability:
      type: object
      properties:
        type:
          type: string
          enum: [search, purchase, execute, analyze]
          example: "search"
        description:
          type: string
          example: "Product search functionality"
        parameters:
          type: object
          additionalProperties:
            type: string
          example:
            max_results: "50"

    QualityRule:
      type: object
      properties:
        metric:
          type: string
          enum: [relevance, completeness, accuracy, helpfulness]
          example: "relevance"
        condition:
          type: string
          enum: [min_relevance, has_price, has_actions]
          example: "min_relevance"
        threshold:
          type: number
          format: float
          example: 0.7
        weight:
          type: number
          format: float
          example: 0.3
        description:
          type: string
          example: "Relevance must be above 0.7"

    DomainMLModel:
      type: object
      properties:
        type:
          type: string
          enum: [classification, regression, nlp]
          example: "classification"
        version:
          type: string
          description: ML model version (Semantic Versioning)
          example: "2.0.0"
        accuracy:
          type: number
          format: float
          example: 0.89
        threshold:
          type: number
          format: float
          example: 0.7
        parameters:
          type: object
          additionalProperties:
            type: string
          example:
            model_path: "/models/commerce-classifier"

    IntegrationConfig:
      type: object
      properties:
        id:
          type: string
          example: "integration-payment-stripe"
        name:
          type: string
          example: "Stripe Payment"
        type:
          type: string
          enum: [payment, delivery, notifications, analytics, custom]
          example: "payment"
        provider:
          type: string
          example: "stripe"
        enabled:
          type: boolean
          example: true
        config:
          type: object
          additionalProperties: true
          example:
            currency: "RUB"
            webhook_secret: "encrypted_secret"
        credentials:
          type: object
          additionalProperties:
            type: string
          example:
            api_key: "encrypted_key"
            publishable_key: "pk_live_..."
        webhook_url:
          type: string
          example: "https://api.nexus.dev/webhooks/stripe"
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            environment: "production"

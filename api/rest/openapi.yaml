openapi: 3.0.3
info:
  title: Nexus Protocol - HTTP REST API
  description: |
    Nexus AI Platform - Nexus Protocol
    HTTP REST API Specification v2.0.0
  version: 2.0.0
  contact:
    name: Биркин Максим
    email: contact@nexus.dev
  license:
    name: MIT

servers:
  - url: http://localhost:8080/api/v1
    description: Development server
  - url: https://api.nexus.dev/api/v1
    description: Production server

security:
  - bearerAuth: []
  - apiKey: []

paths:
  # Health Checks
  /health:
    get:
      summary: Health check
      description: Basic health check for load balancers
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: "1.0.0"

  /ready:
    get:
      summary: Readiness probe
      description: Detailed readiness check for Kubernetes
      responses:
        '200':
          description: Service is ready
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ready"
                  timestamp:
                    type: string
                    format: date-time
                  checks:
                    type: object
                    properties:
                      database:
                        type: string
                        example: "ok"
                      redis:
                        type: string
                        example: "ok"
                      ai_services:
                        type: string
                        example: "ok"

  # Context-Aware Templates
  /templates/execute:
    post:
      summary: Execute context-aware template
      description: Execute a template with AI-powered context analysis
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  description: User query in natural language
                  example: "хочу борщ"
                  minLength: 1
                  maxLength: 1000
                language:
                  type: string
                  description: Language code (ISO 639-1)
                  example: "ru"
                  enum: ["ru", "en"]
                  default: "ru"
                context:
                  $ref: '#/components/schemas/UserContext'
                options:
                  $ref: '#/components/schemas/ExecuteOptions'
                metadata:
                  $ref: '#/components/schemas/RequestMetadata'
      responses:
        '200':
          description: Template executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/ExecuteTemplateResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/AuthenticationError'
        '429':
          $ref: '#/components/responses/RateLimitError'
        '500':
          $ref: '#/components/responses/InternalError'

  /templates/status/{executionId}:
    get:
      summary: Get execution status
      description: Get the status of a template execution
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Execution ID
      responses:
        '200':
          description: Execution status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/TemplateExecution'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /templates/stream/{executionId}:
    get:
      summary: Stream template results
      description: Stream template execution results in real-time (Server-Sent Events)
      security:
        - bearerAuth: []
      parameters:
        - name: executionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Server-Sent Events stream
          content:
            text/event-stream:
              schema:
                type: string
                example: |
                  event: domain_result
                  data: {"domain_id": "commerce", "status": "completed", "results": [...]}

                  event: execution_complete
                  data: {"execution_id": "123", "status": "completed"}

  # Identity & Access Management
  /auth/register:
    post:
      summary: Register new user
      description: Create a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - first_name
                - last_name
              properties:
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  minLength: 8
                  example: "password123"
                first_name:
                  type: string
                  example: "John"
                last_name:
                  type: string
                  example: "Doe"
                tenant_id:
                  type: string
                  format: uuid
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      user_id:
                        type: string
                        format: uuid
                      message:
                        type: string
                        example: "User registered successfully"
                      verification_required:
                        type: boolean
                        example: true
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      summary: User login
      description: Authenticate user and return JWT tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                        example: "eyJhbGciOiJSUzI1NiIs..."
                      refresh_token:
                        type: string
                        example: "refresh_token_123"
                      token_type:
                        type: string
                        example: "Bearer"
                      expires_in:
                        type: integer
                        example: 3600
                      user:
                        $ref: '#/components/schemas/UserProfile'
        '401':
          $ref: '#/components/responses/AuthenticationError'

  /auth/refresh:
    post:
      summary: Refresh access token
      description: Get new access token using refresh token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token refreshed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      access_token:
                        type: string
                      token_type:
                        type: string
                        example: "Bearer"
                      expires_in:
                        type: integer

  /users/profile:
    get:
      summary: Get user profile
      description: Get current user profile information
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/UserProfile'
    put:
      summary: Update user profile
      description: Update current user profile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                first_name:
                  type: string
                last_name:
                  type: string
                bio:
                  type: string
                  maxLength: 500
      responses:
        '200':
          description: Profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/UserProfile'

  # Conversational AI
  /conversations:
    post:
      summary: Create conversation
      description: Start a new AI conversation
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "Recipe Discussion"
                bot_id:
                  type: string
                  format: uuid
                context:
                  type: object
                system_prompt:
                  type: string
      responses:
        '201':
          description: Conversation created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conversation'

  /conversations/{conversationId}:
    get:
      summary: Get conversation
      description: Get conversation details and messages
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Conversation retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/Conversation'

  /conversations/{conversationId}/messages:
    post:
      summary: Send message
      description: Send a message to the AI conversation
      security:
        - bearerAuth: []
      parameters:
        - name: conversationId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                message_type:
                  type: string
                  enum: [text, voice, image]
                  default: text
                metadata:
                  type: object
      responses:
        '200':
          description: Message processed
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/MessageResponse'

  # Analytics
  /analytics/events:
    post:
      summary: Log analytics event
      description: Log an analytics event for tracking
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - event_type
              properties:
                event_type:
                  type: string
                  example: "user_login"
                user_id:
                  type: string
                  format: uuid
                tenant_id:
                  type: string
                  format: uuid
                data:
                  type: object
      responses:
        '201':
          description: Event logged
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      event_id:
                        type: string
                        format: uuid
                      message:
                        type: string
                      timestamp:
                        type: string
                        format: date-time

    get:
      summary: Get analytics events
      description: Retrieve analytics events with filtering
      security:
        - bearerAuth: []
      parameters:
        - name: event_type
          in: query
          schema:
            type: string
        - name: user_id
          in: query
          schema:
            type: string
            format: uuid
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Events retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      events:
                        type: array
                        items:
                          $ref: '#/components/schemas/AnalyticsEvent'
                      total:
                        type: integer
                      limit:
                        type: integer
                      offset:
                        type: integer

  /analytics/stats:
    get:
      summary: Get analytics statistics
      description: Get comprehensive analytics statistics
      security:
        - bearerAuth: []
      parameters:
        - name: user_id
          in: query
          schema:
            type: string
            format: uuid
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
        - name: days
          in: query
          schema:
            type: integer
            minimum: 1
            default: 7
      responses:
        '200':
          description: Statistics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AnalyticsStats'

  # Enterprise Batch Operations v1.1.0
  /batch/execute:
    post:
      summary: Execute batch operations
      description: Execute multiple template operations in a single request
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - requests
              properties:
                requests:
                  type: array
                  items:
                    $ref: '#/components/schemas/ExecuteTemplateRequest'
                  minItems: 1
                  maxItems: 100
                batch_options:
                  $ref: '#/components/schemas/ExecuteOptions'
                metadata:
                  $ref: '#/components/schemas/RequestMetadata'
      responses:
        '200':
          description: Batch executed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/BatchResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  /batch/{batchId}/status:
    get:
      summary: Get batch execution status
      description: Get the status of a batch execution
      security:
        - bearerAuth: []
      parameters:
        - name: batchId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Batch execution ID
      responses:
        '200':
          description: Batch status retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/BatchResponse'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'

  # Enterprise Webhook Management v1.1.0
  /webhooks:
    post:
      summary: Register webhook
      description: Register a new webhook for event notifications
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
                - events
              properties:
                url:
                  type: string
                  format: uri
                  example: "https://api.company.com/webhooks/nexus"
                events:
                  type: array
                  items:
                    type: string
                    enum: [template_executed, batch_completed, error_occurred]
                  example: ["template_executed", "batch_completed"]
                headers:
                  type: object
                  additionalProperties:
                    type: string
                secret:
                  type: string
                  minLength: 16
                  description: Secret for webhook signature verification
      responses:
        '201':
          description: Webhook registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/WebhookConfig'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
    get:
      summary: List webhooks
      description: Get list of registered webhooks
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Webhooks retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookConfig'

  /webhooks/{webhookId}:
    delete:
      summary: Unregister webhook
      description: Remove a webhook registration
      security:
        - bearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Webhook ID
      responses:
        '204':
          description: Webhook unregistered

  # Frontend Configuration (Public)
  /frontend/config:
    get:
      summary: Get active frontend configuration
      description: |
        Returns the active frontend configuration including theme, colors, layout, and branding.
        This is a public endpoint that does not require authentication.
      tags:
        - Frontend
      responses:
        '200':
          description: Frontend configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
                  metadata:
                    $ref: '#/components/schemas/ResponseMetadata'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /webhooks/{webhookId}/deliveries:
    get:
      summary: Get webhook deliveries
      description: Get delivery history for a webhook
      security:
        - bearerAuth: []
      parameters:
        - name: webhookId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: Webhook ID
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Deliveries retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/WebhookDelivery'

  # Admin Panel Endpoints (Superuser only)
  /admin/ai/config:
    get:
      summary: Get AI configuration
      description: Retrieve current AI provider and model configuration
      tags:
        - Admin
        - AI
      security:
        - bearerAuth: []
      responses:
        '200':
          description: AI configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/AIConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update AI configuration
      description: Update AI provider and model configuration
      tags:
        - Admin
        - AI
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AIConfig'
      responses:
        '200':
          description: AI configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "AI configuration updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/prompts:
    get:
      summary: List prompts
      description: Get list of prompts, optionally filtered by domain
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: domain
          in: query
          schema:
            type: string
            enum: [commerce, recipes, travel, knowledge, health, finance]
          description: Filter by domain
        - name: active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Prompts retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PromptConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create prompt
      description: Create a new prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromptConfig'
      responses:
        '201':
          description: Prompt created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/prompts/{id}:
    get:
      summary: Get prompt
      description: Get a specific prompt by ID
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      responses:
        '200':
          description: Prompt retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update prompt
      description: Update a prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PromptConfig'
      responses:
        '200':
          description: Prompt updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/PromptConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete prompt
      description: Delete a prompt configuration
      tags:
        - Admin
        - Prompts
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Prompt ID
      responses:
        '204':
          description: Prompt deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains:
    get:
      summary: List domains
      description: Get list of all domain configurations
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Domains retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DomainConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create domain
      description: Create a new domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainConfig'
      responses:
        '201':
          description: Domain created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}:
    get:
      summary: Get domain
      description: Get a specific domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Domain retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain
      description: Update a domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainConfig'
      responses:
        '200':
          description: Domain updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete domain
      description: Delete a domain configuration
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '204':
          description: Domain deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/keywords:
    get:
      summary: Get domain keywords
      description: Get keywords for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Keywords retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: string
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain keywords
      description: Update keywords for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
      responses:
        '200':
          description: Keywords updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain keywords updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/capabilities:
    get:
      summary: Get domain capabilities
      description: Get capabilities for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Capabilities retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DomainCapability'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain capabilities
      description: Update capabilities for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DomainCapability'
      responses:
        '200':
          description: Capabilities updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain capabilities updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/quality-rules:
    get:
      summary: Get domain quality rules
      description: Get quality rules for a specific domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: Quality rules retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/QualityRule'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain quality rules
      description: Update quality rules for a domain
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/QualityRule'
      responses:
        '200':
          description: Quality rules updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain quality rules updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/{id}/ml-model:
    get:
      summary: Get domain ML model
      description: Get ML model configuration for a specific domain
      tags:
        - Admin
        - Domains
        - ML
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      responses:
        '200':
          description: ML model retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/DomainMLModel'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update domain ML model
      description: Update ML model configuration for a domain
      tags:
        - Admin
        - Domains
        - ML
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Domain ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DomainMLModel'
      responses:
        '200':
          description: ML model updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Domain ML model updated successfully"
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/domains/initialize-default:
    post:
      summary: Initialize default domains
      description: Create default domain configurations
      tags:
        - Admin
        - Domains
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Default domains initialized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Default domains initialized successfully"
                  domains_created:
                    type: integer
                    example: 6
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/integrations:
    get:
      summary: List integrations
      description: Get list of integrations, optionally filtered by type
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [payment, delivery, notifications, analytics, custom]
          description: Filter by integration type
      responses:
        '200':
          description: Integrations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/IntegrationConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create integration
      description: Create a new integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationConfig'
      responses:
        '201':
          description: Integration created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/integrations/{id}:
    get:
      summary: Get integration
      description: Get a specific integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      responses:
        '200':
          description: Integration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update integration
      description: Update an integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IntegrationConfig'
      responses:
        '200':
          description: Integration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/IntegrationConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete integration
      description: Delete an integration configuration
      tags:
        - Admin
        - Integrations
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Integration ID
      responses:
        '204':
          description: Integration deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs:
    get:
      summary: List frontend configurations
      description: Get list of all frontend configurations
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Frontend configurations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'
    post:
      summary: Create frontend configuration
      description: Create a new frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrontendConfig'
      responses:
        '201':
          description: Frontend configuration created
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs/{id}:
    get:
      summary: Get frontend configuration
      description: Get a specific frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '200':
          description: Frontend configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    put:
      summary: Update frontend configuration
      description: Update a frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FrontendConfig'
      responses:
        '200':
          description: Frontend configuration updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'
    delete:
      summary: Delete frontend configuration
      description: Delete a frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '204':
          description: Frontend configuration deleted
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/active:
    get:
      summary: Get active frontend configuration
      description: Get the currently active frontend configuration
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Active frontend configuration retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    $ref: '#/components/schemas/FrontendConfig'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

  /admin/frontend/configs/{id}/active:
    put:
      summary: Set active frontend configuration
      description: Set a frontend configuration as active
      tags:
        - Admin
        - Frontend
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Frontend configuration ID
      responses:
        '200':
          description: Frontend configuration set as active
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Frontend configuration set as active"
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key

  schemas:
    # Common schemas
    RequestMetadata:
      type: object
      properties:
        request_id:
          type: string
          format: uuid
          example: "550e8400-e29b-41d4-a716-446655440000"
        client_version:
          type: string
          example: "1.0.0"
        protocol_version:
          type: string
          example: "1.1.0"
        client_id:
          type: string
          example: "web-app"
        client_type:
          type: string
          enum: [web, mobile, sdk, api]
          example: "web"
        timestamp:
          type: integer
          format: int64
          example: 1640995200
        custom_headers:
          type: object
          additionalProperties:
            type: string

    ResponseMetadata:
      type: object
      properties:
        request_id:
          type: string
          format: uuid
        server_version:
          type: string
          example: "1.1.0"
        protocol_version:
          type: string
          example: "1.1.0"
        timestamp:
          type: integer
          format: int64
        processing_time_ms:
          type: integer
          example: 150
        # Enterprise features v1.1.0
        rate_limit_info:
          $ref: '#/components/schemas/RateLimitInfo'
        cache_info:
          $ref: '#/components/schemas/CacheInfo'
        quota_info:
          $ref: '#/components/schemas/QuotaInfo'

    ErrorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: "VALIDATION_FAILED"
            type:
              type: string
              example: "VALIDATION_ERROR"
            message:
              type: string
              example: "Query cannot be empty"
            field:
              type: string
              example: "query"
            details:
              type: string
            metadata:
              type: object

    # Domain-specific schemas
    UserContext:
      type: object
      properties:
        user_id:
          type: string
          format: uuid
        session_id:
          type: string
        tenant_id:
          type: string
          format: uuid
        location:
          $ref: '#/components/schemas/UserLocation'

    UserLocation:
      type: object
      properties:
        latitude:
          type: number
          format: float
          minimum: -90
          maximum: 90
        longitude:
          type: number
          format: float
          minimum: -180
          maximum: 180
        accuracy:
          type: number
          format: float
          minimum: 0

    ExecuteOptions:
      type: object
      properties:
        timeout_ms:
          type: integer
          minimum: 0
          maximum: 120000
          default: 30000
        max_results_per_domain:
          type: integer
          minimum: 0
          maximum: 50
          default: 5
        parallel_execution:
          type: boolean
          default: true
        include_web_search:
          type: boolean
          default: true

    ExecuteTemplateResponse:
      type: object
      properties:
        execution_id:
          type: string
          format: uuid
        intent_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [in_progress, completed, partial, failed, timeout]
        query_type:
          type: string
          enum: [information_only, with_purchases_services, mixed]
        sections:
          type: array
          items:
            $ref: '#/components/schemas/DomainSection'
        web_search:
          $ref: '#/components/schemas/WebSearchResult'
        ranking:
          $ref: '#/components/schemas/RankingResult'
        metadata:
          $ref: '#/components/schemas/ExecutionMetadata'
        processing_time_ms:
          type: integer
        domain_analysis:
          $ref: '#/components/schemas/DomainAnalysisResult'
        response_metadata:
          $ref: '#/components/schemas/ResponseMetadata'
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    DomainSection:
      type: object
      properties:
        domain_id:
          type: string
          example: "commerce"
        title:
          type: string
          example: "Product Recommendations"
        status:
          type: string
          enum: [success, error, timeout, partial]
        error:
          type: string
        response_time_ms:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/ResultItem'

    ResultItem:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          example: "product"
        title:
          type: string
        description:
          type: string
        data:
          type: object
        relevance:
          type: number
          format: float
          minimum: 0
          maximum: 1
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
        actions:
          type: array
          items:
            $ref: '#/components/schemas/Action'

    Action:
      type: object
      properties:
        type:
          type: string
          example: "add_to_cart"
        label:
          type: string
          example: "Добавить в корзину"
        url:
          type: string
        method:
          type: string
          enum: [GET, POST, PUT, DELETE]
        confirm_text:
          type: string

    WebSearchResult:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/SearchResult'
        search_engine:
          type: string
          example: "google"
        total_results:
          type: integer

    SearchResult:
      type: object
      properties:
        title:
          type: string
        url:
          type: string
        snippet:
          type: string
        relevance:
          type: number
          format: float

    RankingResult:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/RankedItem'
        algorithm:
          type: string
          example: "relevance_score"

    RankedItem:
      type: object
      properties:
        id:
          type: string
        score:
          type: number
          format: float
        rank:
          type: integer

    ExecutionMetadata:
      type: object
      properties:
        started_at:
          type: integer
          format: int64
        completed_at:
          type: integer
          format: int64
        total_time_ms:
          type: integer
        domain_stats:
          type: object
          additionalProperties:
            type: integer
        domains_executed:
          type: integer
        results_count:
          type: integer

    TemplateExecution:
      type: object
      properties:
        id:
          type: string
          format: uuid
        intent_id:
          type: string
          format: uuid
        status:
          type: string
          enum: [in_progress, completed, partial, failed, timeout]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
        error_message:
          type: string

    # AI Domain Analysis Schemas
    DomainAnalysisResult:
      type: object
      description: Результат анализа выбора доменов
      properties:
        selected_domains:
          type: array
          items:
            $ref: '#/components/schemas/DomainSelection'
        rejected_domains:
          type: array
          items:
            $ref: '#/components/schemas/DomainSelection'
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
          description: Общая уверенность анализа
        analysis_algorithm:
          type: string
          example: "hybrid_keyword_semantic"

    DomainSelection:
      type: object
      description: Выбор домена с анализом
      properties:
        domain_id:
          type: string
          example: "commerce"
        name:
          type: string
          example: "Коммерция и покупки"
        type:
          type: string
          example: "commerce"
        confidence:
          type: number
          format: float
          minimum: 0
          maximum: 1
        relevance:
          type: number
          format: float
          minimum: 0
          maximum: 1
        reason:
          type: string
        priority:
          type: integer
          minimum: 0
          maximum: 100
        metadata:
          type: object
          additionalProperties:
            type: string
        capabilities:
          type: array
          items:
            $ref: '#/components/schemas/DomainCapability'

    DomainCapability:
      type: object
      description: Возможности домена
      properties:
        type:
          type: string
          example: "search"
        description:
          type: string
          example: "Поиск в домене"
        parameters:
          type: object
          additionalProperties:
            type: string

    ResponseQualityAnalysis:
      type: object
      description: Анализ качества ответа домена
      properties:
        domain_id:
          type: string
          example: "commerce"
        overall_quality:
          type: number
          format: float
          minimum: 0
          maximum: 1
        relevance_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
        completeness_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
        accuracy_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
        helpfulness_score:
          type: number
          format: float
          minimum: 0
          maximum: 1
        issues:
          type: array
          items:
            $ref: '#/components/schemas/QualityIssue'
        suggestions:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties:
            type: string

    QualityIssue:
      type: object
      description: Проблема с качеством ответа
      properties:
        type:
          type: string
          enum: [relevance, completeness, accuracy, helpfulness]
        severity:
          type: string
          enum: [low, medium, high, critical]
        description:
          type: string
        suggestion:
          type: string

    DomainRoutingDecision:
      type: object
      description: Решение о маршрутизации запроса
      properties:
        domain_id:
          type: string
        action:
          type: string
          enum: [execute, reroute, skip, fallback]
        priority:
          type: integer
          minimum: 0
          maximum: 100
        reason:
          type: string
        alternatives:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties: true

    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        username:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        status:
          type: string
          enum: [active, inactive, suspended]
        roles:
          type: array
          items:
            type: string
        created_at:
          type: integer
          format: int64
        last_login_at:
          type: integer
          format: int64

    Conversation:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        bot_id:
          type: string
          format: uuid
        title:
          type: string
        status:
          type: string
          enum: [active, archived, deleted]
        message_count:
          type: integer
        created_at:
          type: string
          format: date-time
        last_activity:
          type: string
          format: date-time
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'

    Message:
      type: object
      properties:
        id:
          type: string
          format: uuid
        conversation_id:
          type: string
          format: uuid
        sender_id:
          type: string
          format: uuid
        sender_type:
          type: string
          enum: [user, assistant, system]
        type:
          type: string
          enum: [text, voice, image]
        content:
          type: string
        status:
          type: string
          enum: [sent, delivered, read, failed]
        created_at:
          type: string
          format: date-time
        intent:
          type: string

    MessageResponse:
      type: object
      properties:
        conversation_id:
          type: string
          format: uuid
        user_message:
          $ref: '#/components/schemas/Message'
        ai_response:
          $ref: '#/components/schemas/Message'
        conversation_status:
          type: string
        total_messages:
          type: integer

    AnalyticsEvent:
      type: object
      properties:
        id:
          type: string
          format: uuid
        event_type:
          type: string
        user_id:
          type: string
          format: uuid
        tenant_id:
          type: string
          format: uuid
        data:
          type: object
        timestamp:
          type: string
          format: date-time

    AnalyticsStats:
      type: object
      properties:
        period_days:
          type: integer
        total_events:
          type: integer
        total_users:
          type: integer
        active_users:
          type: integer
        events_today:
          type: integer
        top_events:
          type: array
          items:
            type: object
            properties:
              event:
                type: string
              count:
                type: integer
              percentage:
                type: number
                format: float
        user_activity:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
                format: date
              active_users:
                type: integer
              total_events:
                type: integer

    # Enterprise Features v1.1.0
    RateLimitInfo:
      type: object
      properties:
        requests_remaining:
          type: integer
          description: Remaining requests in current window
        reset_time_seconds:
          type: integer
          description: Seconds until limit reset
        limit_type:
          type: string
          enum: [per_user, per_tenant, global]
          description: Type of rate limit

    CacheInfo:
      type: object
      properties:
        cache_hit:
          type: boolean
          description: Whether result was served from cache
        cache_key:
          type: string
          description: Cache key used
        ttl_remaining_seconds:
          type: integer
          description: Remaining TTL in seconds

    QuotaInfo:
      type: object
      properties:
        daily_requests_used:
          type: integer
          description: Requests used today
        daily_requests_limit:
          type: integer
          description: Daily request limit
        monthly_requests_used:
          type: integer
          description: Requests used this month
        monthly_requests_limit:
          type: integer
          description: Monthly request limit

    BatchResponse:
      type: object
      properties:
        batch_id:
          type: string
          format: uuid
        responses:
          type: array
          items:
            $ref: '#/components/schemas/ExecuteTemplateResponse'
        batch_metadata:
          $ref: '#/components/schemas/BatchMetadata'

    BatchMetadata:
      type: object
      properties:
        total_requests:
          type: integer
        successful_requests:
          type: integer
        failed_requests:
          type: integer
        started_at:
          type: integer
          format: int64
        completed_at:
          type: integer
          format: int64
        total_processing_time_ms:
          type: integer

    WebhookConfig:
      type: object
      properties:
        webhook_id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
        events:
          type: array
          items:
            type: string
            enum: [template_executed, batch_completed, error_occurred]
        headers:
          type: object
          additionalProperties:
            type: string
        secret:
          type: string
        created_at:
          type: string
          format: date-time

    WebhookDelivery:
      type: object
      properties:
        delivery_id:
          type: string
          format: uuid
        webhook_id:
          type: string
          format: uuid
        event_type:
          type: string
        payload:
          type: string
        signature:
          type: string
        delivered_at:
          type: string
          format: date-time
        status_code:
          type: integer
        response_body:
          type: string

  responses:
    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    AuthenticationError:
      description: Authentication failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    AuthorizationError:
      description: Authorization failed
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    NotFoundError:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    RateLimitError:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

    FrontendConfig:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Corporate Theme"
        theme:
          type: string
          enum: [light, dark, custom]
          example: "light"
        colors:
          type: object
          additionalProperties:
            type: string
          example:
            primary: "#0066CC"
            secondary: "#00CC66"
            accent: "#FF6600"
            background: "#FFFFFF"
            text: "#333333"
        layout:
          type: object
          additionalProperties: true
          example:
            header:
              height: "64px"
              sticky: true
            sidebar:
              width: "240px"
              collapsible: true
        components:
          type: object
          additionalProperties: true
          example:
            button:
              border_radius: "8px"
              padding: "12px 24px"
            card:
              shadow: "0 2px 8px rgba(0,0,0,0.1)"
              border_radius: "12px"
        branding:
          type: object
          additionalProperties:
            type: string
          example:
            logo: "https://cdn.example.com/logo.png"
            name: "Nexus Protocol"
            favicon: "https://cdn.example.com/favicon.ico"
        active:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    # Admin Schemas
    AIConfig:
      type: object
      properties:
        provider:
          type: string
          enum: [openai, anthropic, local, custom]
          example: "openai"
        model:
          type: string
          example: "gpt-4-turbo"
        api_key:
          type: string
          description: "Encrypted API key"
        base_url:
          type: string
          example: "https://api.openai.com/v1"
        max_tokens:
          type: integer
          example: 4000
        temperature:
          type: number
          format: float
          example: 0.7
        top_p:
          type: number
          format: float
          example: 1.0
        timeout:
          type: integer
          example: 60
        custom_params:
          type: object
          additionalProperties:
            type: string
          example:
            presence_penalty: "0.0"
            frequency_penalty: "0.0"
        enabled:
          type: boolean
          example: true

    PromptConfig:
      type: object
      properties:
        id:
          type: string
          example: "prompt-commerce-001"
        name:
          type: string
          example: "Commerce Product Search"
        description:
          type: string
          example: "Prompt for product search"
        domain:
          type: string
          enum: [commerce, recipes, travel, knowledge, health, finance]
          example: "commerce"
        type:
          type: string
          enum: [system, user, assistant]
          example: "system"
        template:
          type: string
          example: "You are a helpful assistant for product search. Query: {{query}}"
        variables:
          type: array
          items:
            type: string
          example: ["query", "location"]
        version:
          type: integer
          example: 1
        active:
          type: boolean
          example: true
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            author: "admin"
            tags: "commerce,search"

    DomainConfig:
      type: object
      properties:
        id:
          type: string
          example: "domain-commerce-001"
        name:
          type: string
          example: "Commerce Service"
        type:
          type: string
          enum: [commerce, recipes, travel, knowledge, health, finance, custom]
          example: "commerce"
        enabled:
          type: boolean
          example: true
        endpoint:
          type: string
          example: "https://commerce-api.example.com/v1"
        auth_type:
          type: string
          enum: [none, api_key, oauth2, jwt]
          example: "api_key"
        auth_config:
          type: object
          additionalProperties:
            type: string
          example:
            api_key: "encrypted_key"
            header_name: "X-API-Key"
        timeout:
          type: integer
          example: 30
        retry_count:
          type: integer
          example: 3
        priority:
          type: integer
          minimum: 0
          maximum: 100
          example: 80
        keywords:
          type: array
          items:
            type: string
          example: ["купить", "цена", "магазин", "товар"]
        capabilities:
          type: array
          items:
            $ref: '#/components/schemas/DomainCapability'
        quality_rules:
          type: array
          items:
            $ref: '#/components/schemas/QualityRule'
        ml_model:
          $ref: '#/components/schemas/DomainMLModel'
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            version: "1.0.0"
            region: "us-east-1"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DomainCapability:
      type: object
      properties:
        type:
          type: string
          enum: [search, purchase, execute, analyze]
          example: "search"
        description:
          type: string
          example: "Product search functionality"
        parameters:
          type: object
          additionalProperties:
            type: string
          example:
            max_results: "50"

    QualityRule:
      type: object
      properties:
        metric:
          type: string
          enum: [relevance, completeness, accuracy, helpfulness]
          example: "relevance"
        condition:
          type: string
          enum: [min_relevance, has_price, has_actions]
          example: "min_relevance"
        threshold:
          type: number
          format: float
          example: 0.7
        weight:
          type: number
          format: float
          example: 0.3
        description:
          type: string
          example: "Relevance must be above 0.7"

    DomainMLModel:
      type: object
      properties:
        type:
          type: string
          enum: [classification, regression, nlp]
          example: "classification"
        version:
          type: string
          example: "1.0.0"
        accuracy:
          type: number
          format: float
          example: 0.89
        threshold:
          type: number
          format: float
          example: 0.7
        parameters:
          type: object
          additionalProperties:
            type: string
          example:
            model_path: "/models/commerce-classifier"

    IntegrationConfig:
      type: object
      properties:
        id:
          type: string
          example: "integration-payment-stripe"
        name:
          type: string
          example: "Stripe Payment"
        type:
          type: string
          enum: [payment, delivery, notifications, analytics, custom]
          example: "payment"
        provider:
          type: string
          example: "stripe"
        enabled:
          type: boolean
          example: true
        config:
          type: object
          additionalProperties: true
          example:
            currency: "RUB"
            webhook_secret: "encrypted_secret"
        credentials:
          type: object
          additionalProperties:
            type: string
          example:
            api_key: "encrypted_key"
            publishable_key: "pk_live_..."
        webhook_url:
          type: string
          example: "https://api.nexus.dev/webhooks/stripe"
        metadata:
          type: object
          additionalProperties:
            type: string
          example:
            environment: "production"
